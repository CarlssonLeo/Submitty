def gen_script()
  setup_cmd = 'bash ${GIT_PATH}/.setup/'
  
  setup_cmd += 'vagrant/setup_vagrant.sh --no_submissions'

  script = <<SCRIPT
    GIT_PATH=/usr/local/submitty/GIT_CHECKOUT/Submitty
    DISTRO=$(lsb_release -si | tr '[:upper:]' '[:lower:]')
    VERSION=$(lsb_release -sr | tr '[:upper:]' '[:lower:]')
    mkdir -p ${GIT_PATH}/.vagrant/logs
    cd /usr/local/submitty/GIT_CHECKOUT
    sudo rm Submitty -r
    git clone https://github.com/Submitty/Submitty.git
    #{setup_cmd}
SCRIPT

  return script
end

Vagrant.configure("2") do |config|
  config.vm.box = "perk/ubuntu-2204-arm64"
  config.ssh.insert_key = false
  vm_name = 'ubuntu-22.04'
  config.vm.provider "libvirt" do |libvirt|
    # Customize VM settings as needed
    libvirt.memory = 1024
    libvirt.cpus = 1
    libvirt.machine_type = "virt-4.0-armv7l"
    # libvirt.disk_bus = "virtio"
  end
  config.vm.define vm_name, primary: true do |ubuntu|
    ubuntu.vm.provision 'shell', inline: gen_script()
  end
end